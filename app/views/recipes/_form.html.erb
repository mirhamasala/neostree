<%= form_with model: @recipe do |f| %>
  <div class="form-grid">
    <!-- Recipe Details -->
    <div class="mb-6">
      <div class="mb-4">
        <%= f.label :title %>
        <%= f.text_field :title, placeholder: true %>
      </div>

      <div class="mb-4">
        <%= f.label :photo %>
        <%= f.file_field :photo, as: :file %>
      </div>

      <div class="mb-4">
        <%= f.label :intro %>
        <%= f.text_area :intro, placeholder: true %>
      </div>

      <div class="mb-4">
        <%= f.label :source %>
        <%= f.text_field :source, placeholder: true %>
      </div>

      <div>
        <%= f.label :yield %>
        <div class="inline-flex">
          <%= f.collection_select :yield_type, human_attribute_yield_types, :first, :second %>
          <%= f.number_field :yield, class: "ml-4" %>
        </div>
      </div>
    </div>

    <!-- Ingredients -->
    <h2 class="subheading"><%= t('.subheading_measures') %></h2>
    <div class="mb-6" data-controller="new-fields">
      <template data-target="new-fields.template">
        <%= f.fields_for :measures, Measure.new, child_index: 'NEW_RECORD' do |measure| %>
          <%= render "measure_fields", f: measure %>
        <% end %>
      </template>

      <div class="mb-4" data-target="new-fields.fieldsContainer" data-controller="sortable" data-sortable-url="/recipes/:recipe_id/measures/:id/measure_position">
        <%= f.fields_for :measures, @recipe.measures.order(position: :asc), include_id: false do |measure| %>
          <%= render "measure_fields", f: measure %>
        <% end %>

        <% @new_measures.to_i.times do |index| %>
          <%= f.fields_for :measures, Measure.new, child_index: Time.current.to_i + index do |measureField| %>
            <%= render "measure_fields", f: measureField %>
          <% end %>
        <% end %>
      </div>

      <button type="button" data-action="new-fields#addNewField" class="text-sea-800 underline hover:text-sea-300">Add an ingredient</button>
    </div>

    <!-- Directions -->
    <h2 class="subheading"><%= t('.subheading_steps') %></h2>
    <div class="mb-6" data-controller="new-fields">
      <template data-target="new-fields.template">
        <%= f.fields_for :steps, Step.new, child_index: 'NEW_RECORD' do |step| %>
          <%= render "step_fields", f: step %>
        <% end %>
      </template>

      <div class="mb-4" data-target="new-fields.fieldsContainer" data-controller="sortable" data-sortable-url="/recipes/:recipe_id/steps/:id/step_position">
        <%= f.fields_for :steps, @recipe.steps.ordered, include_id: false do |step| %>
          <%= render "step_fields", f: step %>
        <% end %>

        <% @new_steps.to_i.times do |index| %>
          <%= f.fields_for :steps, Step.new, child_index: Time.current.to_i + index do |stepField| %>
            <%= render "step_fields", f: stepField %>
          <% end %>
        <% end %>
      </div>

      <button type="button" data-action="new-fields#addNewField" class="text-sea-800 underline hover:text-sea-300">Add a step</button>
    </div>

    <!-- Recipe Notes -->
    <h2 class="subheading"><%= t('.subheading_notes') %></h2>
    <div class="mb-6">
      <div class="mb-4">
        <%= f.text_area :notes, placeholder: true %>
      </div>
    </div>
  </div>

  <div class="flex">
    <%= f.submit class: "button button--primary button--xl mr-2" %>
    <%= link_to t('.link_cancel'), root_path, class: "button button--secondary" %>
  </div>
<% end %>
